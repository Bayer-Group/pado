name: pado ci

on: [pull_request]

jobs:
  # RUN PYTEST ON PADO SOURCE
  tests:
    name: pytest ${{ matrix.os }}::py${{ matrix.python-version }}
    runs-on: ${{ matrix.os }}
    strategy:
      max-parallel: 5
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        python-version: [3.8]
        # include:
        #   # we'll test the python support on ubuntu
        #   - os: ubuntu-latest
        #     python-version: 3.7
        #   - os: ubuntu-latest
        #     python-version: 3.6
    steps:
    - uses: actions/checkout@v3

    - name: Make python reference python3 because conda-devenv needs it
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install pado with testing devs
      id: pip-cache
      run: |
        python -m pip install --upgrade pip
        python -m pip install .[cli,create,dev]

    - name: Test with pytest
      shell: bash -l {0}
      run: |
        if [ "$RUNNER_OS" == "Windows" ]; then
          pytest --cov=pado ./pado/tests || echo "::warning:: Windows tests failed, but failure is ignored"
        else
          pytest --cov=pado ./pado/tests
        fi
